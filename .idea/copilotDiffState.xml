<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/pom.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/pom.xml" />
              <option name="originalContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&#10;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;&#10;         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&#10;         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;&#10;    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;&#10;&#10;    &lt;groupId&gt;ar.utn.ba.ddsi&lt;/groupId&gt;&#10;    &lt;artifactId&gt;apipublica&lt;/artifactId&gt;&#10;    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;&#10;    &lt;parent&gt;&#10;        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&#10;        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;&#10;        &lt;version&gt;3.5.5&lt;/version&gt;&#10;        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;&#10;    &lt;/parent&gt;&#10;&#10;    &lt;name&gt;apipublica&lt;/name&gt;&#10;    &lt;description&gt;Demo API Publica&lt;/description&gt;&#10;&#10;    &lt;properties&gt;&#10;        &lt;java.version&gt;17&lt;/java.version&gt;&#10;        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;&#10;    &lt;/properties&gt;&#10;    &lt;dependencies&gt;&#10;        &lt;dependency&gt;&#10;            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&#10;            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;&#10;        &lt;/dependency&gt;&#10;&#10;        &lt;dependency&gt;&#10;            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&#10;            &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;&#10;        &lt;/dependency&gt;&#10;&#10;        &lt;dependency&gt;&#10;            &lt;groupId&gt;com.h2database&lt;/groupId&gt;&#10;            &lt;artifactId&gt;h2&lt;/artifactId&gt;&#10;            &lt;scope&gt;runtime&lt;/scope&gt;&#10;        &lt;/dependency&gt;&#10;&#10;        &lt;dependency&gt;&#10;            &lt;groupId&gt;com.mysql&lt;/groupId&gt;&#10;            &lt;artifactId&gt;mysql-connector-j&lt;/artifactId&gt;&#10;            &lt;scope&gt;runtime&lt;/scope&gt;&#10;        &lt;/dependency&gt;&#10;&#10;        &lt;dependency&gt;&#10;            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&#10;            &lt;artifactId&gt;spring-boot-starter-quartz&lt;/artifactId&gt;&#10;        &lt;/dependency&gt;&#10;&#10;        &lt;dependency&gt;&#10;            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;&#10;            &lt;artifactId&gt;lombok&lt;/artifactId&gt;&#10;            &lt;optional&gt;true&lt;/optional&gt;&#10;        &lt;/dependency&gt;&#10;&#10;        &lt;!-- Jackson Databind --&gt;&#10;        &lt;dependency&gt;&#10;            &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;&#10;            &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;&#10;        &lt;/dependency&gt;&#10;&#10;        &lt;!-- JUnit Jupiter --&gt;&#10;        &lt;dependency&gt;&#10;            &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;&#10;            &lt;artifactId&gt;junit-jupiter-engine&lt;/artifactId&gt;&#10;            &lt;version&gt;5.9.2&lt;/version&gt;&#10;            &lt;scope&gt;test&lt;/scope&gt;&#10;        &lt;/dependency&gt;&#10;&#10;        &lt;dependency&gt;&#10;            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&#10;            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;&#10;            &lt;scope&gt;test&lt;/scope&gt;&#10;        &lt;/dependency&gt;&#10;    &lt;/dependencies&gt;&#10;    &lt;build&gt;&#10;        &lt;plugins&gt;&#10;            &lt;plugin&gt;&#10;                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&#10;                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;&#10;                &lt;configuration&gt;&#10;                    &lt;mainClass&gt;ar.utn.ba.ddsi.apipublica.ApiPublicaApplication&lt;/mainClass&gt;&#10;                &lt;/configuration&gt;&#10;            &lt;/plugin&gt;&#10;        &lt;/plugins&gt;&#10;    &lt;/build&gt;&#10;&lt;/project&gt;" />
              <option name="updatedContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&#10;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;&#10;         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&#10;         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;&#10;    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;&#10;&#10;    &lt;groupId&gt;ar.utn.ba.ddsi&lt;/groupId&gt;&#10;    &lt;artifactId&gt;apipublica&lt;/artifactId&gt;&#10;    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;&#10;    &lt;parent&gt;&#10;        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&#10;        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;&#10;        &lt;version&gt;3.5.5&lt;/version&gt;&#10;        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;&#10;    &lt;/parent&gt;&#10;&#10;    &lt;name&gt;apipublica&lt;/name&gt;&#10;    &lt;description&gt;Demo API Publica&lt;/description&gt;&#10;&#10;    &lt;properties&gt;&#10;        &lt;java.version&gt;17&lt;/java.version&gt;&#10;        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;&#10;    &lt;/properties&gt;&#10;    &lt;dependencies&gt;&#10;        &lt;dependency&gt;&#10;            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&#10;            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;&#10;        &lt;/dependency&gt;&#10;&#10;        &lt;dependency&gt;&#10;            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&#10;            &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;&#10;        &lt;/dependency&gt;&#10;&#10;        &lt;dependency&gt;&#10;            &lt;groupId&gt;com.h2database&lt;/groupId&gt;&#10;            &lt;artifactId&gt;h2&lt;/artifactId&gt;&#10;            &lt;scope&gt;runtime&lt;/scope&gt;&#10;        &lt;/dependency&gt;&#10;&#10;        &lt;dependency&gt;&#10;            &lt;groupId&gt;com.mysql&lt;/groupId&gt;&#10;            &lt;artifactId&gt;mysql-connector-j&lt;/artifactId&gt;&#10;            &lt;scope&gt;runtime&lt;/scope&gt;&#10;        &lt;/dependency&gt;&#10;&#10;        &lt;dependency&gt;&#10;            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&#10;            &lt;artifactId&gt;spring-boot-starter-quartz&lt;/artifactId&gt;&#10;        &lt;/dependency&gt;&#10;&#10;        &lt;dependency&gt;&#10;            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;&#10;            &lt;artifactId&gt;lombok&lt;/artifactId&gt;&#10;            &lt;optional&gt;true&lt;/optional&gt;&#10;        &lt;/dependency&gt;&#10;&#10;        &lt;!-- Jackson Databind --&gt;&#10;        &lt;dependency&gt;&#10;            &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;&#10;            &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;&#10;        &lt;/dependency&gt;&#10;&#10;        &lt;!-- JUnit Jupiter --&gt;&#10;        &lt;dependency&gt;&#10;            &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;&#10;            &lt;artifactId&gt;junit-jupiter-engine&lt;/artifactId&gt;&#10;            &lt;version&gt;5.9.2&lt;/version&gt;&#10;            &lt;scope&gt;test&lt;/scope&gt;&#10;        &lt;/dependency&gt;&#10;&#10;        &lt;dependency&gt;&#10;            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&#10;            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;&#10;            &lt;scope&gt;test&lt;/scope&gt;&#10;        &lt;/dependency&gt;&#10;    &lt;/dependencies&gt;&#10;    &lt;build&gt;&#10;        &lt;plugins&gt;&#10;            &lt;plugin&gt;&#10;                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&#10;                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;&#10;                &lt;configuration&gt;&#10;                    &lt;mainClass&gt;ar.utn.ba.ddsi.apipublica.ApiPublicaApplication&lt;/mainClass&gt;&#10;                &lt;/configuration&gt;&#10;            &lt;/plugin&gt;&#10;        &lt;/plugins&gt;&#10;    &lt;/build&gt;&#10;&lt;/project&gt;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/ar/utn/ba/ddsi/apipublica/ApiPublicaApplication.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/ar/utn/ba/ddsi/apipublica/ApiPublicaApplication.java" />
              <option name="originalContent" value="package ar.utn.ba.ddsi.apipublica;&#10;&#10;import org.springframework.boot.SpringApplication;&#10;import org.springframework.boot.autoconfigure.SpringBootApplication;&#10;&#10;//TIP To &lt;b&gt;Run&lt;/b&gt; code, press &lt;shortcut actionId=&quot;Run&quot;/&gt; or&#10;// click the &lt;icon src=&quot;AllIcons.Actions.Execute&quot;/&gt; icon in the gutter.&#10;@SpringBootApplication&#10;public class ApiPublicaApplication {&#10;    public static void main(String[] args) {&#10;        SpringApplication.run(ApiPublicaApplication.class, args);&#10;        System.out.println(&quot;API PUBLICA INICIADA&quot;);&#10;    }&#10;}" />
              <option name="updatedContent" value="package ar.utn.ba.ddsi.apipublica;&#10;&#10;import org.springframework.boot.SpringApplication;&#10;import org.springframework.boot.autoconfigure.SpringBootApplication;&#10;&#10;//TIP To &lt;b&gt;Run&lt;/b&gt; code, press &lt;shortcut actionId=&quot;Run&quot;/&gt; or&#10;// click the &lt;icon src=&quot;AllIcons.Actions.Execute&quot;/&gt; icon in the gutter.&#10;@SpringBootApplication&#10;public class ApiPublicaApplication {&#10;    public static void main(String[] args) {&#10;        SpringApplication.run(ApiPublicaApplication.class, args);&#10;        System.out.println(&quot;API PUBLICA INICIADA&quot;);&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/ar/utn/ba/ddsi/apipublica/models/repository/ContribuyenteRepository.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/ar/utn/ba/ddsi/apipublica/models/repository/ContribuyenteRepository.java" />
              <option name="originalContent" value="package ar.utn.ba.ddsi.apipublica.models.repository;&#10;&#10;import ar.utn.ba.ddsi.apipublica.models.entities.Contribuyente;&#10;import org.springframework.data.jpa.repository.JpaRepository;&#10;import org.springframework.stereotype.Repository;&#10;&#10;@Repository&#10;public interface ContribuyenteRepository extends JpaRepository&lt;Contribuyente, Long&gt; {&#10;    // JpaRepository ya provee findById, findAll, save, delete, etc.&#10;}&#10;" />
              <option name="updatedContent" value="package ar.utn.ba.ddsi.apipublica.models.repository;&#10;&#10;import ar.utn.ba.ddsi.apipublica.models.entities.Contribuyente;&#10;import org.springframework.data.jpa.repository.JpaRepository;&#10;import org.springframework.stereotype.Repository;&#10;&#10;@Repository&#10;public interface ContribuyenteRepository extends JpaRepository&lt;Contribuyente, Long&gt; {&#10;    // JpaRepository ya provee findById, findAll, save, delete, etc.&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/ar/utn/ba/ddsi/apipublica/models/repository/FuenteRepository.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/ar/utn/ba/ddsi/apipublica/models/repository/FuenteRepository.java" />
              <option name="originalContent" value="package ar.utn.ba.ddsi.apipublica.models.repository;&#10;&#10;import ar.utn.ba.ddsi.apipublica.models.entities.Fuente;&#10;import org.springframework.data.jpa.repository.JpaRepository;&#10;import org.springframework.stereotype.Repository;&#10;&#10;import java.util.Optional;&#10;&#10;@Repository&#10;public interface FuenteRepository extends JpaRepository&lt;Fuente, Long&gt; {&#10;    Optional&lt;Fuente&gt; findById(long idFuente);&#10;    Optional&lt;Fuente&gt; findByNombreIgnoreCase(String nombre);&#10;}&#10;" />
              <option name="updatedContent" value="package ar.utn.ba.ddsi.apipublica.models.repository;&#10;&#10;import ar.utn.ba.ddsi.apipublica.models.entities.Fuente;&#10;import org.springframework.data.jpa.repository.JpaRepository;&#10;import org.springframework.stereotype.Repository;&#10;&#10;import java.util.Optional;&#10;&#10;@Repository&#10;public interface FuenteRepository extends JpaRepository&lt;Fuente, Long&gt; {&#10;    Optional&lt;Fuente&gt; findById(long idFuente);&#10;    Optional&lt;Fuente&gt; findByNombreIgnoreCase(String nombre);&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/ar/utn/ba/ddsi/apipublica/models/repository/SolicitudRepository.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/ar/utn/ba/ddsi/apipublica/models/repository/SolicitudRepository.java" />
              <option name="originalContent" value="package ar.utn.ba.ddsi.apipublica.models.repository;&#10;&#10;import ar.utn.ba.ddsi.apipublica.models.entities.SolicitudEliminacion;&#10;import org.springframework.data.jpa.repository.JpaRepository;&#10;import org.springframework.stereotype.Repository;&#10;&#10;@Repository&#10;public interface SolicitudRepository extends JpaRepository&lt;SolicitudEliminacion, Long&gt; {&#10;}&#10;" />
              <option name="updatedContent" value="package ar.utn.ba.ddsi.apipublica.models.repository;&#10;&#10;import ar.utn.ba.ddsi.apipublica.models.entities.SolicitudEliminacion;&#10;import org.springframework.data.jpa.repository.JpaRepository;&#10;import org.springframework.stereotype.Repository;&#10;&#10;@Repository&#10;public interface SolicitudRepository extends JpaRepository&lt;SolicitudEliminacion, Long&gt; {&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/ar/utn/ba/ddsi/apipublica/services/HechoService.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/ar/utn/ba/ddsi/apipublica/services/HechoService.java" />
              <option name="originalContent" value="package ar.utn.ba.ddsi.apipublica.services;&#10;&#10;import ar.utn.ba.ddsi.apipublica.models.dtos.HechoCreateDTO;&#10;import ar.utn.ba.ddsi.apipublica.models.dtos.HechoFilterDTO;&#10;import ar.utn.ba.ddsi.apipublica.models.dtos.HechoRtaDTO;&#10;import ar.utn.ba.ddsi.apipublica.models.entities.*;&#10;import ar.utn.ba.ddsi.apipublica.models.repository.*;&#10;import org.springframework.stereotype.Service;&#10;&#10;import java.time.LocalDate;&#10;import java.time.format.DateTimeParseException;&#10;import java.util.ArrayList;&#10;import java.util.List;&#10;import java.util.Optional;&#10;&#10;@Service&#10;public class HechoService implements IHechoService {&#10;&#10;    private final HechoRepository hechoRepository;&#10;    private final CategoriaRepository categoriaRepository;&#10;    private final FuenteRepository fuenteRepository;&#10;    private final UbicacionRepository ubicacionRepository;&#10;    private final AdjuntoRepository adjuntoRepository;&#10;&#10;    public HechoService(HechoRepository hechoRepository,&#10;                        CategoriaRepository categoriaRepository,&#10;                        FuenteRepository fuenteRepository,&#10;                        UbicacionRepository ubicacionRepository,&#10;                        AdjuntoRepository adjuntoRepository) {&#10;        this.hechoRepository = hechoRepository;&#10;        this.categoriaRepository = categoriaRepository;&#10;        this.fuenteRepository = fuenteRepository;&#10;        this.ubicacionRepository = ubicacionRepository;&#10;        this.adjuntoRepository = adjuntoRepository;&#10;    }&#10;&#10;    @Override&#10;    public Hecho crearHecho(HechoCreateDTO dto){&#10;        // Lógica de conversión y creación&#10;        Hecho hecho = new Hecho();&#10;        hecho.setTitulo(dto.getTitulo());&#10;        hecho.setDescripcion(dto.getDescripcion());&#10;&#10;        // Conversión segura de fecha&#10;        if (dto.getFecha() != null &amp;&amp; !dto.getFecha().isBlank()) {&#10;            try {&#10;                hecho.setFecha(LocalDate.parse(dto.getFecha()));&#10;            } catch (DateTimeParseException e) {&#10;                // excepción personalizada si la fecha es inválida  VER ESTO DEL FORMATO&#10;                throw new IllegalArgumentException(&quot;Formato de fecha inválido: &quot; + dto.getFecha());&#10;            }&#10;        }&#10;&#10;        // Categoria: buscar por nombre, si no existe -&gt; error&#10;        if (dto.getCategoria() != null &amp;&amp; !dto.getCategoria().isBlank()) {&#10;            Optional&lt;Categoria&gt; catOpt = categoriaRepository.findByNombreIgnoreCase(dto.getCategoria());&#10;            if (catOpt.isEmpty()) {&#10;                throw new IllegalArgumentException(&quot;Categoria no existe: &quot; + dto.getCategoria());&#10;            }&#10;            hecho.setCategoria(catOpt.get());&#10;        }&#10;        // Fuente: viene id numerico, intento buscar-&gt; error&#10;        if (dto.getFuente() != null &amp;&amp; !dto.getFuente().isBlank()) {&#10;            boolean fuenteSet = false;&#10;            try {&#10;                long idFuente = Long.parseLong(dto.getFuente());&#10;                Optional&lt;Fuente&gt; fOpt = fuenteRepository.findById(idFuente);&#10;                if (fOpt.isPresent()) {&#10;                    hecho.setFuente(fOpt.get());&#10;                    fuenteSet = true;&#10;                }&#10;            } catch (NumberFormatException nfe) {&#10;                // No es un id; intento buscar por nombre  //ES una buena opcion hablar conlos chicos&#10;                Optional&lt;Fuente&gt; fOpt2 = fuenteRepository.findByNombreIgnoreCase(dto.getFuente());&#10;                if (fOpt2.isPresent()) {&#10;                    hecho.setFuente(fOpt2.get());&#10;                    fuenteSet = true;&#10;                }&#10;            }&#10;            if (!fuenteSet) {&#10;                throw new IllegalArgumentException(&quot;Fuente no existe: &quot; + dto.getFuente());&#10;            }&#10;        }&#10;        if (dto.getUbicacionLat() != null &amp;&amp; !dto.getUbicacionLat().isBlank()&#10;                &amp;&amp; dto.getUbicacionLon() != null &amp;&amp; !dto.getUbicacionLon().isBlank()) {&#10;            try {&#10;                float lat = Float.parseFloat(dto.getUbicacionLat());&#10;                float lon = Float.parseFloat(dto.getUbicacionLon());&#10;                // Crear y guardar provincia con un genrador&#10;                Ubicacion u = new Ubicacion(lat, lon,new Provincia(&quot;as&quot;,&quot;eeee&quot;));&#10;                hecho.setUbicacion(ubicacionRepository.save(u));&#10;            } catch (NumberFormatException nfe) {&#10;                throw new IllegalArgumentException(&quot;Latitud o longitud inválida&quot;);&#10;            }&#10;        }&#10;&#10;        // Tipo de hecho: intentar parsear el enum&#10;        if (dto.getTipoHecho() != null &amp;&amp; !dto.getTipoHecho().isBlank()) {&#10;            try {&#10;                EnumTipoHecho tipo = EnumTipoHecho.valueOf(dto.getTipoHecho());&#10;                hecho.setTipoHecho(tipo);&#10;            } catch (IllegalArgumentException iae) {&#10;                throw new IllegalArgumentException(&quot;Tipo de hecho inválido: &quot; + dto.getTipoHecho());&#10;            }&#10;        }&#10;        //PROBAR ESTO&#10;        List&lt;Adjunto&gt; listaAdjuntos = new ArrayList&lt;&gt;();&#10;        if (dto.getAdjuntos() != null) {&#10;            for (String a : dto.getAdjuntos()) {&#10;                if (a == null || a.isBlank()) continue;&#10;                Adjunto adj = new Adjunto();&#10;                adj.setTipo(null);&#10;                adj.setUrl(a);&#10;                listaAdjuntos.add(adjuntoRepository.save(adj));&#10;            }&#10;        }&#10;        hecho.setAdjuntos(listaAdjuntos);&#10;&#10;        // Fecha de carga&#10;        hecho.setFechaDeCarga(LocalDate.now());&#10;&#10;        // Guardar en la base de datos&#10;        //Deberìa mandarselo al Agregador de Hechos&#10;        return hechoRepository.save(hecho);&#10;    }&#10;&#10;    @Override&#10;    public List&lt;HechoRtaDTO&gt; buscarConFiltro(HechoFilterDTO filter) {&#10;        System.out.println(&quot;Buscando hechos con filtro&quot;);&#10;&#10;        if (filter == null) {&#10;            List&lt;Hecho&gt; all = hechoRepository.findAll();&#10;            return PasarAHechoDTO(all);&#10;        }&#10;&#10;        // Validar y parsear usando el DTO&#10;        filter.validateAndParse();&#10;&#10;        String categoriaNombre = null;&#10;        if(filter.getCategoria() != null &amp;&amp; !filter.getCategoria().isBlank()) {&#10;            categoriaNombre = filter.getCategoria();&#10;        }&#10;&#10;        // Determinar delta para proximidad en grados (por defecto 0.01 ~ 1km)&#10;        Float delta = null;&#10;        if (filter.getUbicacionLatitudParsed() != null &amp;&amp; filter.getUbicacionLongitudParsed() != null) {&#10;            delta = 0.01f; // valor configurable si se desea&#10;        }&#10;&#10;        // Usar campos parseados&#10;        List&lt;Hecho&gt; resultados = hechoRepository.buscarHechosSegun(&#10;                categoriaNombre,&#10;                filter.getFechaReporteDesdeParsed(),&#10;                filter.getFechaReporteHastaParsed(),&#10;                filter.getFechaAcontecimientoDesdeParsed(),&#10;                filter.getFechaAcontecimientoHastaParsed(),&#10;                filter.getUbicacionLatitudParsed(),&#10;                filter.getUbicacionLongitudParsed(),&#10;                delta&#10;        );&#10;&#10;        System.out.println(&quot;Resultados encontrados: &quot; + (resultados == null ? 0 : resultados.size()));&#10;        return PasarAHechoDTO(resultados);&#10;    }&#10;    public List&lt;HechoRtaDTO&gt; PasarAHechoDTO(List&lt;Hecho&gt; hechos) {&#10;        List&lt;HechoRtaDTO&gt; hechosDTO = new ArrayList&lt;&gt;();&#10;        if(hechos==null) return hechosDTO;&#10;        for(Hecho h : hechos) {&#10;            HechoRtaDTO dto = new HechoRtaDTO();&#10;            dto.HechoAHechoRtaDTO(h);&#10;            hechosDTO.add(dto);&#10;        }&#10;        return hechosDTO;&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package ar.utn.ba.ddsi.apipublica.services;&#10;&#10;import ar.utn.ba.ddsi.apipublica.models.dtos.HechoCreateDTO;&#10;import ar.utn.ba.ddsi.apipublica.models.dtos.HechoFilterDTO;&#10;import ar.utn.ba.ddsi.apipublica.models.dtos.HechoRtaDTO;&#10;import ar.utn.ba.ddsi.apipublica.models.entities.*;&#10;import ar.utn.ba.ddsi.apipublica.models.repository.*;&#10;import org.springframework.stereotype.Service;&#10;&#10;import java.time.LocalDate;&#10;import java.time.format.DateTimeParseException;&#10;import java.util.ArrayList;&#10;import java.util.List;&#10;import java.util.Optional;&#10;&#10;@Service&#10;public class HechoService implements IHechoService {&#10;&#10;    private final HechoRepository hechoRepository;&#10;    private final CategoriaRepository categoriaRepository;&#10;    private final FuenteRepository fuenteRepository;&#10;    private final UbicacionRepository ubicacionRepository;&#10;    private final AdjuntoRepository adjuntoRepository;&#10;&#10;    public HechoService(HechoRepository hechoRepository,&#10;                        CategoriaRepository categoriaRepository,&#10;                        FuenteRepository fuenteRepository,&#10;                        UbicacionRepository ubicacionRepository,&#10;                        AdjuntoRepository adjuntoRepository) {&#10;        this.hechoRepository = hechoRepository;&#10;        this.categoriaRepository = categoriaRepository;&#10;        this.fuenteRepository = fuenteRepository;&#10;        this.ubicacionRepository = ubicacionRepository;&#10;        this.adjuntoRepository = adjuntoRepository;&#10;    }&#10;&#10;    @Override&#10;    public Hecho crearHecho(HechoCreateDTO dto){&#10;        // Lógica de conversión y creación&#10;        Hecho hecho = new Hecho();&#10;        hecho.setTitulo(dto.getTitulo());&#10;        hecho.setDescripcion(dto.getDescripcion());&#10;&#10;        // Conversión segura de fecha&#10;        if (dto.getFecha() != null &amp;&amp; !dto.getFecha().isBlank()) {&#10;            try {&#10;                hecho.setFecha(LocalDate.parse(dto.getFecha()));&#10;            } catch (DateTimeParseException e) {&#10;                // excepción personalizada si la fecha es inválida  VER ESTO DEL FORMATO&#10;                throw new IllegalArgumentException(&quot;Formato de fecha inválido: &quot; + dto.getFecha());&#10;            }&#10;        }&#10;&#10;        // Categoria: buscar por nombre, si no existe -&gt; error&#10;        if (dto.getCategoria() != null &amp;&amp; !dto.getCategoria().isBlank()) {&#10;            Optional&lt;Categoria&gt; catOpt = categoriaRepository.findByNombreIgnoreCase(dto.getCategoria());&#10;            if (catOpt.isEmpty()) {&#10;                throw new IllegalArgumentException(&quot;Categoria no existe: &quot; + dto.getCategoria());&#10;            }&#10;            hecho.setCategoria(catOpt.get());&#10;        }&#10;        // Fuente: viene id numerico, intento buscar-&gt; error&#10;        if (dto.getFuente() != null &amp;&amp; !dto.getFuente().isBlank()) {&#10;            boolean fuenteSet = false;&#10;            try {&#10;                long idFuente = Long.parseLong(dto.getFuente());&#10;                Optional&lt;Fuente&gt; fOpt = fuenteRepository.findById(idFuente);&#10;                if (fOpt.isPresent()) {&#10;                    hecho.setFuente(fOpt.get());&#10;                    fuenteSet = true;&#10;                }&#10;            } catch (NumberFormatException nfe) {&#10;                // No es un id; intento buscar por nombre  //ES una buena opcion hablar conlos chicos&#10;                Optional&lt;Fuente&gt; fOpt2 = fuenteRepository.findByNombreIgnoreCase(dto.getFuente());&#10;                if (fOpt2.isPresent()) {&#10;                    hecho.setFuente(fOpt2.get());&#10;                    fuenteSet = true;&#10;                }&#10;            }&#10;            if (!fuenteSet) {&#10;                throw new IllegalArgumentException(&quot;Fuente no existe: &quot; + dto.getFuente());&#10;            }&#10;        }&#10;        if (dto.getUbicacionLat() != null &amp;&amp; !dto.getUbicacionLat().isBlank()&#10;                &amp;&amp; dto.getUbicacionLon() != null &amp;&amp; !dto.getUbicacionLon().isBlank()) {&#10;            try {&#10;                float lat = Float.parseFloat(dto.getUbicacionLat());&#10;                float lon = Float.parseFloat(dto.getUbicacionLon());&#10;                // Crear y guardar provincia con un genrador&#10;                Ubicacion u = new Ubicacion(lat, lon,new Provincia(&quot;as&quot;,&quot;eeee&quot;));&#10;                hecho.setUbicacion(ubicacionRepository.save(u));&#10;            } catch (NumberFormatException nfe) {&#10;                throw new IllegalArgumentException(&quot;Latitud o longitud inválida&quot;);&#10;            }&#10;        }&#10;&#10;        // Tipo de hecho: intentar parsear el enum&#10;        if (dto.getTipoHecho() != null &amp;&amp; !dto.getTipoHecho().isBlank()) {&#10;            try {&#10;                EnumTipoHecho tipo = EnumTipoHecho.valueOf(dto.getTipoHecho());&#10;                hecho.setTipoHecho(tipo);&#10;            } catch (IllegalArgumentException iae) {&#10;                throw new IllegalArgumentException(&quot;Tipo de hecho inválido: &quot; + dto.getTipoHecho());&#10;            }&#10;        }&#10;        //PROBAR ESTO&#10;        List&lt;Adjunto&gt; listaAdjuntos = new ArrayList&lt;&gt;();&#10;        if (dto.getAdjuntos() != null) {&#10;            for (String a : dto.getAdjuntos()) {&#10;                if (a == null || a.isBlank()) continue;&#10;                Adjunto adj = new Adjunto();&#10;                adj.setTipo(null);&#10;                adj.setUrl(a);&#10;                listaAdjuntos.add(adjuntoRepository.save(adj));&#10;            }&#10;        }&#10;        hecho.setAdjuntos(listaAdjuntos);&#10;&#10;        // Fecha de carga&#10;        hecho.setFechaDeCarga(LocalDate.now());&#10;&#10;        // Guardar en la base de datos&#10;        //Deberìa mandarselo al Agregador de Hechos&#10;        return hechoRepository.save(hecho);&#10;    }&#10;&#10;    @Override&#10;    public List&lt;HechoRtaDTO&gt; buscarConFiltro(HechoFilterDTO filter) {&#10;        System.out.println(&quot;Buscando hechos con filtro&quot;);&#10;&#10;        if (filter == null) {&#10;            List&lt;Hecho&gt; all = hechoRepository.findAll();&#10;            return PasarAHechoDTO(all);&#10;        }&#10;&#10;        // Validar y parsear usando el DTO&#10;        filter.validateAndParse();&#10;&#10;        String categoriaNombre = null;&#10;        if(filter.getCategoria() != null &amp;&amp; !filter.getCategoria().isBlank()) {&#10;            categoriaNombre = filter.getCategoria();&#10;        }&#10;&#10;        // Determinar delta para proximidad en grados (por defecto 0.01 ~ 1km)&#10;        Float delta = null;&#10;        if (filter.getUbicacionLatitudParsed() != null &amp;&amp; filter.getUbicacionLongitudParsed() != null) {&#10;            delta = 0.01f; // valor configurable si se desea&#10;        }&#10;&#10;        // Usar campos parseados&#10;        List&lt;Hecho&gt; resultados = hechoRepository.buscarHechosSegun(&#10;                categoriaNombre,&#10;                filter.getFechaReporteDesdeParsed(),&#10;                filter.getFechaReporteHastaParsed(),&#10;                filter.getFechaAcontecimientoDesdeParsed(),&#10;                filter.getFechaAcontecimientoHastaParsed(),&#10;                filter.getUbicacionLatitudParsed(),&#10;                filter.getUbicacionLongitudParsed(),&#10;                delta&#10;        );&#10;&#10;        System.out.println(&quot;Resultados encontrados: &quot; + (resultados == null ? 0 : resultados.size()));&#10;        return PasarAHechoDTO(resultados);&#10;    }&#10;    public List&lt;HechoRtaDTO&gt; PasarAHechoDTO(List&lt;Hecho&gt; hechos) {&#10;        List&lt;HechoRtaDTO&gt; hechosDTO = new ArrayList&lt;&gt;();&#10;        if(hechos==null) return hechosDTO;&#10;        for(Hecho h : hechos) {&#10;            HechoRtaDTO dto = new HechoRtaDTO();&#10;            dto.HechoAHechoRtaDTO(h);&#10;            hechosDTO.add(dto);&#10;        }&#10;        return hechosDTO;&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/ar/utn/ba/ddsi/apipublica/services/SolicitudService.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/ar/utn/ba/ddsi/apipublica/services/SolicitudService.java" />
              <option name="originalContent" value="package ar.utn.ba.ddsi.apipublica.services;&#10;&#10;import ar.utn.ba.ddsi.apipublica.models.dtos.SolicitudCreateDTO;&#10;import ar.utn.ba.ddsi.apipublica.models.entities.Contribuyente;&#10;import ar.utn.ba.ddsi.apipublica.models.entities.Hecho;&#10;import ar.utn.ba.ddsi.apipublica.models.entities.SolicitudEliminacion;&#10;import ar.utn.ba.ddsi.apipublica.models.repository.ContribuyenteRepository;&#10;import ar.utn.ba.ddsi.apipublica.models.repository.HechoRepository;&#10;import ar.utn.ba.ddsi.apipublica.models.repository.SolicitudRepository;&#10;import org.springframework.stereotype.Service;&#10;&#10;import java.time.LocalDate;&#10;import java.util.List;&#10;&#10;@Service&#10;public class SolicitudService implements ISolicitudService{&#10;&#10;    private final SolicitudRepository solicitudRepository;&#10;    private final HechoRepository hechoRepository;&#10;    private final ContribuyenteRepository contribuyenteRepository;&#10;&#10;    public SolicitudService(SolicitudRepository solicitudRepository, HechoRepository hechoRepository, ContribuyenteRepository contribuyenteRepository) {&#10;        this.solicitudRepository = solicitudRepository;&#10;        this.hechoRepository = hechoRepository;&#10;        this.contribuyenteRepository = contribuyenteRepository;&#10;    }&#10;&#10;    @Override&#10;    public SolicitudEliminacion crearSolicitud(SolicitudCreateDTO dto) throws IllegalArgumentException{&#10;        if (dto == null) throw new IllegalArgumentException(&quot;Datos de la solicitud vacios&quot;);&#10;        if (dto.getMotivo() == null || dto.getMotivo().trim().isEmpty()) throw new IllegalArgumentException(&quot;Motivo requerido&quot;);&#10;&#10;        Hecho hecho = hechoRepository.findById(dto.getIdHecho()).orElse(null);&#10;        if (hecho == null) throw new IllegalArgumentException(&quot;Hecho no encontrado&quot;);&#10;&#10;        Contribuyente solicitante = contribuyenteRepository.findById(dto.getIdContribuyente()).orElse(null);&#10;        if (solicitante == null) throw new IllegalArgumentException(&quot;Contribuyente no encontrado&quot;);&#10;&#10;        SolicitudEliminacion solicitud = new SolicitudEliminacion(solicitante, hecho, LocalDate.now(), dto.getMotivo());&#10;        return solicitudRepository.save(solicitud);&#10;    }&#10;&#10;    @Override&#10;    public List&lt;SolicitudEliminacion&gt; listarSolicitudes() {&#10;        return solicitudRepository.findAll();&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package ar.utn.ba.ddsi.apipublica.services;&#10;&#10;import ar.utn.ba.ddsi.apipublica.models.dtos.SolicitudCreateDTO;&#10;import ar.utn.ba.ddsi.apipublica.models.entities.Contribuyente;&#10;import ar.utn.ba.ddsi.apipublica.models.entities.Hecho;&#10;import ar.utn.ba.ddsi.apipublica.models.entities.SolicitudEliminacion;&#10;import ar.utn.ba.ddsi.apipublica.models.repository.ContribuyenteRepository;&#10;import ar.utn.ba.ddsi.apipublica.models.repository.HechoRepository;&#10;import ar.utn.ba.ddsi.apipublica.models.repository.SolicitudRepository;&#10;import org.springframework.stereotype.Service;&#10;&#10;import java.time.LocalDate;&#10;import java.util.List;&#10;&#10;@Service&#10;public class SolicitudService implements ISolicitudService{&#10;&#10;    private final SolicitudRepository solicitudRepository;&#10;    private final HechoRepository hechoRepository;&#10;    private final ContribuyenteRepository contribuyenteRepository;&#10;&#10;    public SolicitudService(SolicitudRepository solicitudRepository, HechoRepository hechoRepository, ContribuyenteRepository contribuyenteRepository) {&#10;        this.solicitudRepository = solicitudRepository;&#10;        this.hechoRepository = hechoRepository;&#10;        this.contribuyenteRepository = contribuyenteRepository;&#10;    }&#10;&#10;    @Override&#10;    public SolicitudEliminacion crearSolicitud(SolicitudCreateDTO dto) throws IllegalArgumentException{&#10;        if (dto == null) throw new IllegalArgumentException(&quot;Datos de la solicitud vacios&quot;);&#10;        if (dto.getMotivo() == null || dto.getMotivo().trim().isEmpty()) throw new IllegalArgumentException(&quot;Motivo requerido&quot;);&#10;&#10;        Hecho hecho = hechoRepository.findById(dto.getIdHecho()).orElse(null);&#10;        if (hecho == null) throw new IllegalArgumentException(&quot;Hecho no encontrado&quot;);&#10;&#10;        Contribuyente solicitante = contribuyenteRepository.findById(dto.getIdContribuyente()).orElse(null);&#10;        if (solicitante == null) throw new IllegalArgumentException(&quot;Contribuyente no encontrado&quot;);&#10;&#10;        SolicitudEliminacion solicitud = new SolicitudEliminacion(solicitante, hecho, LocalDate.now(), dto.getMotivo());&#10;        return solicitudRepository.save(solicitud);&#10;    }&#10;&#10;    @Override&#10;    public List&lt;SolicitudEliminacion&gt; listarSolicitudes() {&#10;        return solicitudRepository.findAll();&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>